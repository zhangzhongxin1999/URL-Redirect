<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Content Proxy with URL Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c6bed;
      text-align: center;
    }
    .usage {
      background: #f0f8ff;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    .example {
      font-family: monospace;
      background: #f4f4f4;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      margin: 5px 0;
      word-break: break-all;
    }
    .instructions {
      margin: 20px 0;
    }
    ol {
      padding-left: 20px;
    }
    li {
      margin: 10px 0;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 10px;
      border-radius: 5px;
      margin: 15px 0;
    }
    .feature-box {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    .service-section {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .url-generator {
      background: #f0f8f0;
      border: 1px solid #c8e6c8;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], input[type="url"], textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea {
      height: 120px;
      font-family: monospace;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
    .result {
      margin-top: 15px;
      padding: 10px;
      background-color: #e8f4fd;
      border-radius: 4px;
      display: none;
    }
    .result.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ Universal Content Proxy</h1>
    <div class="warning">
      <strong>ğŸ”’ Security Notice:</strong> For enhanced security, consider restricting access to this service. 
      Visit <a href="/admin/access-control">admin panel</a> to set up authentication (requires credentials).
    </div>
    
    <div class="service-section">
      <h2>1. ğŸ“„ Gist Content Proxy</h2>
      <div class="usage">
        <h3>How to Use</h3>
        <p>Use this service to access GitHub Gist raw content that might be restricted in your region:</p>
        <p>Original URL: <code>https://gist.githubusercontent.com/username/gist-id/raw/file-path</code></p>
        <p>Proxied URL: <span class="example">https://your-site.pages.dev/gist/username/gist-id/raw/file-path</span></p>
      </div>
      
      <div class="feature-box">
        <h3>âœ¨ Feature: Custom Filename</h3>
        <p>Add a <code>?filename=your-desired-name.ext</code> parameter to specify the download filename:</p>
        <p>Custom filename URL: <span class="example">https://your-site.pages.dev/gist/username/gist-id/raw/file-path?filename=my-custom-name.js</span></p>
      </div>
      
      <div class="examples">
        <h3>Examples</h3>
        <p>If your original URL is:</p>
        <div class="example">https://gist.githubusercontent.com/johndoe/abc123def456/raw/script.js</div>
        <p>The basic proxied URL would be:</p>
        <div class="example">https://your-site.pages.dev/gist/johndoe/abc123def456/raw/script.js</div>
        <p>With custom filename:</p>
        <div class="example">https://your-site.pages.dev/gist/johndoe/abc123def456/raw/script.js?filename=my-awesome-script.js</div>
      </div>
    </div>
    
    <div class="service-section">
      <h2>2. âœï¸ Text-to-URL Converter</h2>
      <div class="usage">
        <h3>How to Use</h3>
        <p>Create downloadable text files directly from URL parameters:</p>
        <p>Format: <span class="example">https://your-site.pages.dev/text/filename.ext?content=your-text-content</span></p>
        <p>Or with base64 encoding: <span class="example">https://your-site.pages.dev/text/filename.ext?b64=base64-encoded-content</span></p>
      </div>
      
      <div class="feature-box">
        <h3>ğŸ’¡ Tip: Base64 Encoding</h3>
        <p>For complex text with special characters, use base64 encoding:</p>
        <p>Plain text: <span class="example">https://your-site.pages.dev/text/my-file.txt?content=Hello%20World!</span></p>
        <p>Base64 encoded: <span class="example">https://your-site.pages.dev/text/my-file.txt?b64=SGVsbG8gV29ybGQh</span></p>
      </div>
      
      <div class="examples">
        <h3>Examples</h3>
        <p>Simple text file:</p>
        <div class="example">https://your-site.pages.dev/text/hello.txt?content=Hello%20World</div>
        <p>JavaScript file:</p>
        <div class="example">https://your-site.pages.dev/text/script.js?content=function%20test()%20{%20return%20'Hello';%20}</div>
        <p>JSON file with base64:</p>
        <div class="example">https://your-site.pages.dev/text/data.json?b64=eyAiZGF0YSI6ICJleGFtcGxlIiwgIm51bWJlciI6IDEyMyB9</div>
      </div>
    </div>
    
    <div class="persistent-text-generator">
      <h2>ğŸ’¾ æŒä¹…åŒ–æ–‡æœ¬URLç”Ÿæˆå™¨</h2>
      <p>åˆ›å»ºæŒä¹…åŒ–çš„æ–‡æœ¬å†…å®¹ï¼Œé€šè¿‡å”¯ä¸€IDè®¿é—®ï¼š</p>
      
      <div class="form-group">
        <label for="persistentContent">å†…å®¹ï¼š</label>
        <textarea id="persistentContent" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„æ–‡æœ¬å†…å®¹..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="persistentFilename">æ–‡ä»¶åï¼ˆå¸¦æ‰©å±•åï¼‰ï¼š</label>
        <input type="text" id="persistentFilename" value="config.txt" placeholder="ä¾‹å¦‚ï¼šconfig.json, script.js">
      </div>
      
      <div class="form-group">
        <label for="persistentCustomId">è‡ªå®šä¹‰IDï¼ˆå¯é€‰ï¼‰ï¼š</label>
        <input type="text" id="persistentCustomId" placeholder="ç•™ç©ºä»¥è‡ªåŠ¨ç”ŸæˆID">
      </div>
      
      <div class="form-group">
        <label for="persistentTextSiteUrl">æ‚¨çš„ç½‘ç«™URLï¼š</label>
        <input type="url" id="persistentTextSiteUrl" value="https://your-site.pages.dev" placeholder="ä¾‹å¦‚ï¼šhttps://your-site.pages.dev">
      </div>
      
      <button onclick="createPersistentText()">åˆ›å»ºæŒä¹…åŒ–æ–‡æœ¬URL</button>
      
      <div id="persistentTextResult" class="result">
        <p><strong>æŒä¹…åŒ–æ–‡æœ¬URLï¼š</strong></p>
        <p><a id="persistentTextUrl" href="#" target="_blank"></a></p>
        <p>ID: <span id="persistentTextIdDisplay"></span></p>
      </div>
    </div>
    
    <div class="url-mapper">
      <h2>ğŸ”„ æŒä¹…åŒ–URLæ˜ å°„</h2>
      <p>åˆ›å»ºæŒä¹…åŒ–çš„URLæ˜ å°„ï¼Œé€šè¿‡å”¯ä¸€IDè®¿é—®ï¼š</p>
      
      <div class="form-group">
        <label for="persistentOriginalUrl">è¦æ˜ å°„çš„åŸå§‹URLï¼š</label>
        <input type="url" id="persistentOriginalUrl" placeholder="ä¾‹å¦‚ï¼šhttps://example.com/data.json">
      </div>
      
      <div class="form-group">
        <label for="customMapId">è‡ªå®šä¹‰æ˜ å°„IDï¼ˆå¯é€‰ï¼‰ï¼š</label>
        <input type="text" id="customMapId" placeholder="ç•™ç©ºä»¥è‡ªåŠ¨ç”ŸæˆID">
      </div>
      
      <div class="form-group">
        <label for="persistentSiteUrl">æ‚¨çš„ç½‘ç«™URLï¼š</label>
        <input type="url" id="persistentSiteUrl" value="https://your-site.pages.dev" placeholder="ä¾‹å¦‚ï¼šhttps://your-site.pages.dev">
      </div>
      
      <button onclick="createPersistentMap()">åˆ›å»ºæŒä¹…åŒ–æ˜ å°„</button>
      
      <div id="persistentResult" class="result">
        <p><strong>æŒä¹…åŒ–æ˜ å°„URLï¼š</strong></p>
        <p><a id="persistentUrl" href="#" target="_blank"></a></p>
        <p>æ˜ å°„ID: <span id="mapIdDisplay"></span></p>
      </div>
    </div>
    
    <div class="qrcode-generator">
      <h2>ğŸ“± äºŒç»´ç ç”Ÿæˆå™¨</h2>
      <p>ä¸ºä»»ä½•URLç”ŸæˆäºŒç»´ç ï¼Œæ–¹ä¾¿ç§»åŠ¨è®¾å¤‡æ‰«æï¼š</p>
      
      <div class="form-group">
        <label for="qrcodeUrl">URLï¼š</label>
        <input type="url" id="qrcodeUrl" placeholder="è¾“å…¥è¦ç”ŸæˆäºŒç»´ç çš„URL">
      </div>
      
      <button onclick="generateQRCode()">ç”ŸæˆäºŒç»´ç </button>
      
      <div id="qrcodeResult" class="result">
        <p><strong>äºŒç»´ç ï¼š</strong></p>
        <div id="qrcodeContainer" style="display:flex; justify-content:center; margin:10px 0;"></div>
      </div>
    </div>
    
    <div class="url-mapper">
      <h2>ğŸ”„ URL Mapper</h2>
      <p>Map any URL to a proxy URL that fetches content dynamically:</p>
      
      <div class="form-group">
        <label for="originalUrl">Original URL to map:</label>
        <input type="url" id="originalUrl" placeholder="e.g., https://example.com/data.json">
      </div>
      
      <div class="form-group">
        <label for="mappedSiteUrl">Your Site URL:</label>
        <input type="url" id="mappedSiteUrl" value="https://your-site.pages.dev" placeholder="e.g., https://your-site.pages.dev">
      </div>
      
      <button onclick="generateMappedUrl()">Generate Temporary Mapped URL</button>
      
      <div id="mappedResult" class="result">
        <p><strong>Generated Temporary Mapped URLs:</strong></p>
        <p>Parameter-based: <a id="paramUrl" href="#" target="_blank"></a></p>
        <p>Encoded URL: <a id="encodedUrl" href="#" target="_blank"></a></p>
      </div>
    </div>
    
    <div class="persistent-mapper">
      <h2>ğŸ’¾ Persistent URL Mapper</h2>
      <p>Create persistent URL mappings that are stored and accessible via a unique ID:</p>
      
      <div class="form-group">
        <label for="persistentOriginalUrl">Original URL to map:</label>
        <input type="url" id="persistentOriginalUrl" placeholder="e.g., https://example.com/data.json">
      </div>
      
      <div class="form-group">
        <label for="customMapId">Custom Map ID (optional):</label>
        <input type="text" id="customMapId" placeholder="Leave blank for auto-generated ID">
      </div>
      
      <div class="form-group">
        <label for="persistentSiteUrl">Your Site URL:</label>
        <input type="url" id="persistentSiteUrl" value="https://your-site.pages.dev" placeholder="e.g., https://your-site.pages.dev">
      </div>
      
      <button onclick="createPersistentMap()">Create Persistent Mapping</button>
      
      <div id="persistentResult" class="result">
        <p><strong>Persistent Mapped URL:</strong></p>
        <p><a id="persistentUrl" href="#" target="_blank"></a></p>
        <p>Map ID: <span id="mapIdDisplay"></span></p>
      </div>
    </div>
    
    <div class="instructions">
      <h2>General Instructions</h2>
      <ol>
        <li>For Gist content: Replace the original domain with your Cloudflare Pages domain</li>
        <li>For text content: Use the <code>/text/</code> endpoint with your desired filename and content</li>
        <li>Add <code>?filename=</code> to customize download names for Gist files</li>
        <li>Use <code>?b64=</code> for complex text with special characters</li>
        <li>Use the URL generator above to easily create text-to-URL links</li>
      </ol>
    </div>
    
    <div class="warning">
      <strong>Note:</strong> This proxy is intended to help access legitimate content. Please respect GitHub's Terms of Service and any applicable laws in your jurisdiction.
    </div>
    
    <div class="features">
      <h2>Features</h2>
      <ul>
        <li>Bypasses regional restrictions on GitHub Gist content</li>
        <li>Creates downloadable files from text content in URLs</li>
        <li>URL generator for easy creation of text-to-URL links</li>
        <li>Maintains original content type headers</li>
        <li>Includes caching for improved performance</li>
        <li>Supports all file types (JavaScript, CSS, JSON, text, etc.)</li>
        <li>Custom filename support via <code>?filename=desired-name.ext</code></li>
        <li>Text-to-URL conversion with plain text or base64 content</li>
        <li>Automatic download with specified filename</li>
      </ul>
    </div>
  </div>
  
  <script>
    async function generateUrl() {
      const content = document.getElementById('content').value;
      const filename = document.getElementById('filename').value;
      const siteUrl = document.getElementById('siteUrl').value;
      
      if (!content) {
        alert('Please enter some content');
        return;
      }
      
      if (!filename) {
        alert('Please enter a filename');
        return;
      }
      
      if (!siteUrl) {
        alert('Please enter your site URL');
        return;
      }
      
      try {
        // Use the API endpoint to generate the URL
        const formData = new FormData();
        formData.append('content', content);
        formData.append('filename', filename);
        formData.append('baseUrl', siteUrl);
        
        const response = await fetch('/api/generate-url', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update the result section
          document.getElementById('regularUrl').href = data.url;
          document.getElementById('regularUrl').textContent = data.url;
          document.getElementById('base64Url').href = data.base64Url;
          document.getElementById('base64Url').textContent = data.base64Url;
          
          document.getElementById('result').classList.add('show');
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Error generating URL: ' + error.message);
      }
    }
    
    async function createPersistentMap() {
      const originalUrl = document.getElementById('persistentOriginalUrl').value;
      const customMapId = document.getElementById('customMapId').value;
      const siteUrl = document.getElementById('persistentSiteUrl').value;
      
      if (!originalUrl) {
        alert('Please enter the original URL to map');
        return;
      }
      
      if (!siteUrl) {
        alert('Please enter your site URL');
        return;
      }
      
      try {
        // Use the API endpoint to create a persistent mapping
        const formData = new FormData();
        formData.append('originalUrl', originalUrl);
        formData.append('baseUrl', siteUrl);
        if (customMapId) {
          formData.append('customId', customMapId);
        }
        
        const response = await fetch('/api/create-persistent-map', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update the result section
          document.getElementById('persistentUrl').href = data.mappedUrl;
          document.getElementById('persistentUrl').textContent = data.mappedUrl;
          document.getElementById('mapIdDisplay').textContent = data.mapId;
          
          document.getElementById('persistentResult').classList.add('show');
          
          // Add QR code button
          setTimeout(() => {
            addQRCodeToElement('persistentUrl');
          }, 100);
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Error creating persistent mapping: ' + error.message);
      }
    }
    
    async function createPersistentText() {
      const content = document.getElementById('persistentContent').value;
      const filename = document.getElementById('persistentFilename').value;
      const customId = document.getElementById('persistentCustomId').value;
      const siteUrl = document.getElementById('persistentTextSiteUrl').value;
      
      if (!content) {
        alert('Please enter the content');
        return;
      }
      
      if (!filename) {
        alert('Please enter a filename');
        return;
      }
      
      if (!siteUrl) {
        alert('Please enter your site URL');
        return;
      }
      
      try {
        // Use the API endpoint to create persistent text content
        const formData = new FormData();
        formData.append('content', content);
        formData.append('filename', filename);
        formData.append('baseUrl', siteUrl);
        if (customId) {
          formData.append('customId', customId);
        }
        
        const response = await fetch('/api/create-persistent-text', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update the result section
          document.getElementById('persistentTextUrl').href = data.persistentUrl;
          document.getElementById('persistentTextUrl').textContent = data.persistentUrl;
          document.getElementById('persistentTextIdDisplay').textContent = data.textId;
          
          document.getElementById('persistentTextResult').classList.add('show');
          
          // Add QR code button
          setTimeout(() => {
            addQRCodeToElement('persistentTextUrl');
          }, 100);
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Error creating persistent text: ' + error.message);
      }
    }
    
    async function generateQRCode() {
      const url = document.getElementById('qrcodeUrl').value;
      
      if (!url) {
        alert('Please enter a URL');
        return;
      }
      
      try {
        // Validate URL
        new URL(url);
        
        // Generate QR code using the API
        const qrCodeUrl = `/qrcode/generate?url=${encodeURIComponent(url)}`;
        
        // Create an image element for the QR code
        const img = document.createElement('img');
        img.src = qrCodeUrl;
        img.alt = 'QR Code';
        img.style.maxWidth = '300px';
        img.style.height = 'auto';
        img.onerror = function() {
          alert('Error generating QR code');
        };
        
        // Clear previous QR code and add the new one
        const container = document.getElementById('qrcodeContainer');
        container.innerHTML = '';
        container.appendChild(img);
        
        // Show the result div
        document.getElementById('qrcodeResult').classList.add('show');
      } catch (error) {
        alert('Invalid URL: ' + error.message);
      }
    }
    
    // Add QR code functionality to existing URL generators
    function addQRCodeToElement(elementId) {
      const element = document.getElementById(elementId);
      if (element && element.href) {
        // Create a button to generate QR code for this specific URL
        const qrButton = document.createElement('button');
        qrButton.textContent = 'QR';
        qrButton.onclick = function() {
          const qrCodeUrl = `/qrcode/generate?url=${encodeURIComponent(element.href)}`;
          window.open(qrCodeUrl, '_blank', 'width=350,height=400');
        };
        qrButton.style.marginLeft = '10px';
        qrButton.style.verticalAlign = 'middle';
        element.parentNode.appendChild(qrButton);
      }
    }
  </script>
</body>
</html>